(self.webpackChunkvyxal_github_io=self.webpackChunkvyxal_github_io||[]).push([[547],{3616:e=>{var t;self,t=()=>{return e=t={},Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const i=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),s=parseInt(r.getPropertyValue("height")),n=Math.max(0,parseInt(r.getPropertyValue("width"))),a=window.getComputedStyle(this._terminal.element),o=s-(parseInt(a.getPropertyValue("padding-top"))+parseInt(a.getPropertyValue("padding-bottom"))),l=n-(parseInt(a.getPropertyValue("padding-right"))+parseInt(a.getPropertyValue("padding-left")))-i;return{cols:Math.max(2,Math.floor(l/t.css.cell.width)),rows:Math.max(1,Math.floor(o/t.css.cell.height))}}},t;var e,t},e.exports=t()},5873:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var r=i(4848),s=i(6540),n=i(7856),a=i(3616);var o;!function(e){e[e.Terminated=0]="Terminated",e[e.TimedOut=1]="TimedOut"}(o||(o={}));class l extends EventTarget{constructor(e,t){super(),this.started=new Event("started"),this.finished=new Event("finished"),this.workerCounter=0,this.outputBuffer=[],this._state="booting",this.splashes=e,this.version=t,this.worker=this.spawnWorker()}attach(e){if(null!=this.terminal)throw new Error("Already attached");this.terminal=new n.Terminal({scrollback:1e3,convertEol:!0}),this.fit=new a.FitAddon,this.terminal.loadAddon(this.fit),this.terminal.open(e),this.fit.fit(),new ResizeObserver((()=>requestAnimationFrame((()=>this.onResize())))).observe(e),this.terminal.writeln(`[?25lWelcome to [1;95mVyxal[0m ${this.version}`),this.terminal.writeln(`[2;3m${this.splashes[Math.floor(Math.random()*this.splashes.length)]}[0m`),console.log("Terminal attached")}onResize(){this.fit?.fit()}detach(){if(null==this.terminal)throw new Error("Not attached");this.terminal.dispose(),this.terminal=null,this.fit=null,console.log("Terminal detached")}get state(){return this._state}spawnWorker(){return console.log("Spawning new worker"),this.workerCounter+=1,new Promise((e=>{const t=new Worker(new URL(i.p+i.u(941),i.b),{type:"module"}),r=i=>{"ready"==i.data.type&&(e(t),t.addEventListener("message",this.onWorkerMessage.bind(this)),t.removeEventListener("message",r),console.log("Worker is ready"),this._state="idle")};t.addEventListener("message",r)}))}onWorkerMessage(e){const t=e.data;if(t.workerNumber==this.workerCounter){if(null!=this.terminal)switch(t.type){case"started":this._state="running",this.terminal.clear(),this.dispatchEvent(this.started);break;case"stdout":this.terminal.write(t.text),this.outputBuffer.push(t.text),this.outputBuffer.length=Math.min(this.outputBuffer.length,2e4);break;case"stderr":this.terminal.write(`[31m${t.text}[0m`);break;case"worker-notice":this.terminal.writeln(`[2m${t.text}[0m`);break;case"done":this.terminal.writeln("\n[0G-------"),this.terminal.writeln("[1;92mExecution completed[0m"),this.dispatchEvent(this.finished),this._state="idle"}}else console.warn("Discarding old worker message")}start(e,t,i,r){if("lyxal"!=e)return this.worker.then((s=>{if("running"==this._state)throw new Error("Attempted to start while running");this.terminal?.clear(),this.terminal?.reset(),this.outputBuffer.length=0,s.postMessage({code:e,flags:t,inputs:i,workerNumber:this.workerCounter}),null!=r&&(this.timeoutHandle=window.setTimeout((()=>{this.terminate(o.TimedOut)}),r),this.addEventListener("finished",(()=>window.clearTimeout(this.timeoutHandle)),{once:!0}))}));window.location.assign("https://www.youtube.com/watch?v=dQw4w9WgXcQ")}terminate(e=o.Terminated){if("running"!=this._state)throw new Error("Attempted to terminate worker while not running");console.log("Terminating worker"),this.worker.then((t=>{switch(this._state="booting",this.worker=this.spawnWorker(),t.terminate(),this.terminal?.writeln("\n[0G-------"),e){case o.Terminated:this.terminal?.writeln("[1;31mExecution terminated[0m");break;case o.TimedOut:this.terminal?.writeln("[1;31mExecution timed out[0m")}this.dispatchEvent(this.finished)}))}getOutput(){return this.outputBuffer.join("")}showMessage(e){"idle"==this._state&&(this.terminal?.clear(),this.terminal?.reset(),this.terminal?.write(e))}}var h=i(3234);const d=(0,s.forwardRef)((function({code:e,flags:t,inputs:i,timeout:n,onStart:a,onFinish:d},m){const u=(0,s.useRef)(null),c=(0,s.useContext)(h.ix),w=(0,s.useMemo)((()=>new l("Over 200 stars on Github!\nLow-fat, no sodium\nTerse, Elegant, Readable\nCompatible with all leading brands\nKitchen sink not included\nBatteries included\nGluten free\n".split("\n"),c.version)),[]);return(0,s.useImperativeHandle)(m,(()=>({start(){w.start(e,t,i,n)},stop:()=>w.terminate(o.Terminated),getOutput:()=>w.getOutput(),showMessage:e=>w.showMessage(e)}))),(0,s.useEffect)((()=>(w.attach(u.current),w.addEventListener("started",a),w.addEventListener("finished",d),e.length>0&&w.start(e,t,i,n),()=>{w.detach(),w.removeEventListener("started",a),w.removeEventListener("finished",d)})),[]),(0,r.jsx)("div",{ref:u,className:"terminal-wrapper"})}))}}]);
//# sourceMappingURL=../maps/terminal.06956525.js.map