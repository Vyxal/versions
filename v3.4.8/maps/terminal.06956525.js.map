{"version":3,"file":"scripts/terminal.06956525.js","mappings":"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","sources":["webpack:///./node_modules/@xterm/addon-fit/lib/addon-fit.js","webpack:///./src/latest/scripts/runner.ts","webpack:///./src/latest/scripts/VyTerminal.tsx"],"sourcesContent":["!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.FitAddon=t():e.FitAddon=t()}(self,(()=>(()=>{\"use strict\";var e={};return(()=>{var t=e;Object.defineProperty(t,\"__esModule\",{value:!0}),t.FitAddon=void 0,t.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const r=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue(\"height\")),s=Math.max(0,parseInt(i.getPropertyValue(\"width\"))),n=window.getComputedStyle(this._terminal.element),l=o-(parseInt(n.getPropertyValue(\"padding-top\"))+parseInt(n.getPropertyValue(\"padding-bottom\"))),a=s-(parseInt(n.getPropertyValue(\"padding-right\"))+parseInt(n.getPropertyValue(\"padding-left\")))-r;return{cols:Math.max(2,Math.floor(a/t.css.cell.width)),rows:Math.max(1,Math.floor(l/t.css.cell.height))}}}})(),e})()));\n//# sourceMappingURL=addon-fit.js.map","import { Terminal } from \"@xterm/xterm\";\nimport { FitAddon } from \"@xterm/addon-fit\";\nconst MAX_BUFFER_SIZE = 20000;\nexport var TerminateReason;\n(function (TerminateReason) {\n    TerminateReason[TerminateReason[\"Terminated\"] = 0] = \"Terminated\";\n    TerminateReason[TerminateReason[\"TimedOut\"] = 1] = \"TimedOut\";\n})(TerminateReason || (TerminateReason = {}));\nexport class VyRunner extends EventTarget {\n    constructor(splashes, version) {\n        super();\n        this.started = new Event(\"started\");\n        this.finished = new Event(\"finished\");\n        this.workerCounter = 0;\n        this.outputBuffer = [];\n        this._state = \"booting\";\n        this.splashes = splashes;\n        this.version = version;\n        this.worker = this.spawnWorker();\n    }\n    attach(element) {\n        if (this.terminal != null) {\n            throw new Error(\"Already attached\");\n        }\n        this.terminal = new Terminal({\n            scrollback: 1000,\n            convertEol: true,\n        });\n        this.fit = new FitAddon();\n        this.terminal.loadAddon(this.fit);\n        this.terminal.open(element);\n        this.fit.fit();\n        new ResizeObserver(() => requestAnimationFrame(() => this.onResize())).observe(element);\n        this.terminal.writeln(`\\x1b[?25lWelcome to \\x1b[1;95mVyxal\\x1b[0m ${this.version}`);\n        this.terminal.writeln(`\\x1b[2;3m${this.splashes[Math.floor(Math.random() * this.splashes.length)]}\\x1b[0m`);\n        console.log(\"Terminal attached\");\n    }\n    onResize() {\n        this.fit?.fit();\n    }\n    detach() {\n        if (this.terminal == null) {\n            throw new Error(\"Not attached\");\n        }\n        this.terminal.dispose();\n        this.terminal = null;\n        this.fit = null;\n        console.log(\"Terminal detached\");\n    }\n    get state() {\n        return this._state;\n    }\n    spawnWorker() {\n        console.log(\"Spawning new worker\");\n        this.workerCounter += 1;\n        return new Promise((resolve) => {\n            const worker = new Worker(\n            /* webpackChunkName: \"worker\" */\n            new URL(\"./workers/runner.ts\", import.meta.url));\n            const listener = (event) => {\n                if (event.data.type == \"ready\") {\n                    resolve(worker);\n                    worker.addEventListener(\"message\", this.onWorkerMessage.bind(this));\n                    worker.removeEventListener(\"message\", listener);\n                    console.log(\"Worker is ready\");\n                    this._state = \"idle\";\n                }\n            };\n            // possible race condition? won't appear in practice\n            // but if they ever develop internet that's faster than the speed of light it could be an issue\n            worker.addEventListener(\"message\", listener);\n        });\n    }\n    onWorkerMessage(message) {\n        const data = message.data;\n        if (data.workerNumber != this.workerCounter) {\n            console.warn(\"Discarding old worker message\");\n            return;\n        }\n        if (this.terminal != null) {\n            switch (data.type) {\n                case \"started\":\n                    this._state = \"running\";\n                    this.terminal.clear();\n                    this.dispatchEvent(this.started);\n                    break;\n                case \"stdout\":\n                    this.terminal.write(data.text);\n                    this.outputBuffer.push(data.text);\n                    this.outputBuffer.length = Math.min(this.outputBuffer.length, MAX_BUFFER_SIZE);\n                    break;\n                case \"stderr\":\n                    this.terminal.write(`\\x1b[31m${data.text}\\x1b[0m`);\n                    break;\n                case \"worker-notice\":\n                    this.terminal.writeln(`\\x1b[2m${data.text}\\x1b[0m`);\n                    break;\n                case \"done\":\n                    this.terminal.writeln(\"\\n\\x1b[0G-------\");\n                    this.terminal.writeln(\"\\x1b[1;92mExecution completed\\x1b[0m\");\n                    this.dispatchEvent(this.finished);\n                    this._state = \"idle\";\n            }\n        }\n    }\n    start(code, flags, inputs, timeout) {\n        if (code == \"lyxal\") {\n            window.location.assign(\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\");\n            return;\n        }\n        return this.worker.then((worker) => {\n            if (this._state == \"running\") {\n                throw new Error(\"Attempted to start while running\");\n            }\n            this.terminal?.clear();\n            this.terminal?.reset();\n            this.outputBuffer.length = 0;\n            worker.postMessage({\n                code: code,\n                flags: flags,\n                inputs: inputs,\n                workerNumber: this.workerCounter,\n            });\n            if (timeout != null) {\n                this.timeoutHandle = window.setTimeout(() => {\n                    this.terminate(TerminateReason.TimedOut);\n                }, timeout);\n                this.addEventListener(\"finished\", () => window.clearTimeout(this.timeoutHandle), { once: true });\n            }\n        });\n    }\n    terminate(reason = TerminateReason.Terminated) {\n        if (this._state != \"running\") {\n            throw new Error(\"Attempted to terminate worker while not running\");\n        }\n        console.log(\"Terminating worker\");\n        this.worker.then((worker) => {\n            this._state = \"booting\";\n            this.worker = this.spawnWorker();\n            worker.terminate();\n            this.terminal?.writeln(\"\\n\\x1b[0G-------\");\n            switch (reason) {\n                case TerminateReason.Terminated:\n                    this.terminal?.writeln(\"\\x1b[1;31mExecution terminated\\x1b[0m\");\n                    break;\n                case TerminateReason.TimedOut:\n                    this.terminal?.writeln(\"\\x1b[1;31mExecution timed out\\x1b[0m\");\n                    break;\n            }\n            this.dispatchEvent(this.finished);\n        });\n    }\n    getOutput() {\n        return this.outputBuffer.join(\"\");\n    }\n    showMessage(message) {\n        if (this._state == \"idle\") {\n            this.terminal?.clear();\n            this.terminal?.reset();\n            this.terminal?.write(message);\n        }\n    }\n}\n","import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { forwardRef, useContext, useEffect, useImperativeHandle, useMemo, useRef } from \"react\";\nimport { VyRunner, TerminateReason } from \"./runner\";\nimport { ElementDataContext } from \"./util/element-data\";\nimport splashes from \"../data/splash.txt?raw\";\nconst VyTerminal = forwardRef(function VyTerminal({ code, flags, inputs, timeout, onStart, onFinish }, ref) {\n    const wrapperRef = useRef(null);\n    const elementData = useContext(ElementDataContext);\n    const runner = useMemo(() => new VyRunner(splashes.split(\"\\n\"), elementData.version), []);\n    useImperativeHandle(ref, () => {\n        return {\n            start() {\n                runner.start(code, flags, inputs, timeout);\n            },\n            stop() {\n                return runner.terminate(TerminateReason.Terminated);\n            },\n            getOutput() {\n                return runner.getOutput();\n            },\n            showMessage(message) {\n                return runner.showMessage(message);\n            },\n        };\n    });\n    useEffect(() => {\n        runner.attach(wrapperRef.current);\n        runner.addEventListener(\"started\", onStart);\n        runner.addEventListener(\"finished\", onFinish);\n        if (code.length > 0) {\n            runner.start(code, flags, inputs, timeout);\n        }\n        return () => {\n            runner.detach();\n            runner.removeEventListener(\"started\", onStart);\n            runner.removeEventListener(\"finished\", onFinish);\n        };\n    }, []);\n    return _jsx(\"div\", { ref: wrapperRef, className: \"terminal-wrapper\" });\n});\nexport default VyTerminal;\n"],"names":["t","self","e","Object","defineProperty","value","FitAddon","activate","this","_terminal","dispose","fit","proposeDimensions","isNaN","cols","rows","_core","_renderService","clear","resize","element","parentElement","dimensions","css","cell","width","height","r","options","scrollback","viewport","scrollBarWidth","i","window","getComputedStyle","o","parseInt","getPropertyValue","s","Math","max","n","l","a","floor","module","exports","TerminateReason","VyRunner","EventTarget","constructor","splashes","version","super","started","Event","finished","workerCounter","outputBuffer","_state","worker","spawnWorker","attach","terminal","Error","Terminal","convertEol","loadAddon","open","ResizeObserver","requestAnimationFrame","onResize","observe","writeln","random","length","console","log","detach","state","Promise","resolve","Worker","URL","listener","event","data","type","addEventListener","onWorkerMessage","bind","removeEventListener","message","workerNumber","dispatchEvent","write","text","push","min","warn","start","code","flags","inputs","timeout","then","reset","postMessage","timeoutHandle","setTimeout","terminate","TimedOut","clearTimeout","once","location","assign","reason","Terminated","getOutput","join","showMessage","forwardRef","onStart","onFinish","ref","wrapperRef","useRef","elementData","useContext","runner","useMemo","split","useImperativeHandle","stop","useEffect","current","className"],"sourceRoot":""}