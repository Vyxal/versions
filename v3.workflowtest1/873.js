(self.webpackChunkvyxal_github_io=self.webpackChunkvyxal_github_io||[]).push([[873],{3616:e=>{var t;self,t=()=>{return e=t={},Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const r=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),n=parseInt(i.getPropertyValue("height")),s=Math.max(0,parseInt(i.getPropertyValue("width"))),a=window.getComputedStyle(this._terminal.element),o=n-(parseInt(a.getPropertyValue("padding-top"))+parseInt(a.getPropertyValue("padding-bottom"))),l=s-(parseInt(a.getPropertyValue("padding-right"))+parseInt(a.getPropertyValue("padding-left")))-r;return{cols:Math.max(2,Math.floor(l/t.css.cell.width)),rows:Math.max(1,Math.floor(o/t.css.cell.height))}}},t;var e,t},e.exports=t()},5873:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var i=r(4848),n=r(6540),s=r(7856),a=r(3616);var o;!function(e){e[e.Terminated=0]="Terminated",e[e.TimedOut=1]="TimedOut"}(o||(o={}));class l extends EventTarget{constructor(e,t){super(),this.started=new Event("started"),this.finished=new Event("finished"),this.workerCounter=0,this.outputBuffer=[],this._state="booting",this.splashes=e,this.version=t,this.worker=this.spawnWorker()}attach(e){if(null!=this.terminal)throw new Error("Already attached");this.terminal=new s.Terminal({scrollback:1e3,convertEol:!0}),this.fit=new a.FitAddon,this.terminal.loadAddon(this.fit),this.terminal.open(e),this.fit.fit(),new ResizeObserver((()=>requestAnimationFrame((()=>this.onResize())))).observe(e),this.terminal.writeln(`Welcome to [1;95mVyxal[0m ${this.version}`),this.terminal.writeln(`[2;3m${this.splashes[Math.floor(Math.random()*this.splashes.length)]}[0m`),console.log("Terminal attached")}onResize(){this.fit?.fit()}detach(){if(null==this.terminal)throw new Error("Not attached");this.terminal.dispose(),this.terminal=null,this.fit=null,console.log("Terminal detached")}get state(){return this._state}spawnWorker(){return console.log("Spawning new worker"),this.workerCounter+=1,new Promise((e=>{const t=new Worker(new URL(r.p+r.u(941),r.b),{type:"module"}),i=r=>{"ready"==r.data.type&&(e(t),t.addEventListener("message",this.onWorkerMessage.bind(this)),t.removeEventListener("message",i),console.log("Worker is ready"))};t.addEventListener("message",i)}))}onWorkerMessage(e){const t=e.data;if(t.workerNumber==this.workerCounter){if(null!=this.terminal)switch(t.type){case"started":this._state="running",this.terminal.clear(),this.dispatchEvent(this.started);break;case"stdout":this.terminal.write(t.text),this.outputBuffer.push(t.text),this.outputBuffer.length=Math.min(this.outputBuffer.length,2e4);break;case"stderr":this.terminal.write(`[31m${t.text}[0m`);break;case"worker-notice":this.terminal.writeln(`[2m${t.text}[0m`);break;case"done":this.terminal.writeln("\n[0G-------"),this.terminal.writeln("[1;92mExecution completed[0m"),this.dispatchEvent(this.finished),this._state="idle"}}else console.warn("Discarding old worker message")}start(e,t,r,i){return this.worker.then((n=>{if("running"==this._state)throw new Error("Attempted to start while running");this.terminal?.clear(),this.outputBuffer.length=0,n.postMessage({code:e,flags:t,inputs:r,workerNumber:this.workerCounter}),this.timeoutHandle=window.setTimeout((()=>{this.terminate(o.TimedOut)}),i),this.addEventListener("finished",(()=>window.clearTimeout(this.timeoutHandle)),{once:!0})}))}terminate(e=o.Terminated){if("running"!=this._state)throw new Error("Attempted to terminate worker while not running");console.log("Terminating worker"),this.worker.then((t=>{switch(this._state="booting",this.worker=this.spawnWorker(),t.terminate(),this.terminal?.writeln("\n[0G-------"),e){case o.Terminated:this.terminal?.writeln("[1;31mExecution terminated[0m");break;case o.TimedOut:this.terminal?.writeln("[1;31mExecution timed out[0m")}this.dispatchEvent(this.finished)}))}getOutput(){return this.outputBuffer.join("")}}var h=r(3234);const d=(0,n.forwardRef)((function({code:e,flags:t,inputs:r,timeout:s,onStart:a,onFinish:d},u){const m=(0,n.useRef)(null),c=(0,n.useContext)(h.ix),w=(0,n.useRef)(new l("Over 200 stars on Github!\nLow-fat, no sodium\nTerse, Elegant, Readable\nCompatible with all leading brands\nKitchen sink not included\nBatteries included".split("\n"),c.version));return(0,n.useImperativeHandle)(u,(()=>({start(){w.current.start(e,t,r,s)},stop:()=>w.current.terminate(o.Terminated),getOutput:w.current.getOutput}))),(0,n.useEffect)((()=>(w.current.attach(m.current),w.current.addEventListener("started",a),w.current.addEventListener("finished",d),e.length>0&&w.current.start(e,t,r,s),()=>{w.current.detach(),w.current.removeEventListener("started",a),w.current.removeEventListener("finished",d)})),[]),(0,i.jsx)("div",{ref:m,className:"terminal-wrapper"})}))}}]);
//# sourceMappingURL=873.js.map