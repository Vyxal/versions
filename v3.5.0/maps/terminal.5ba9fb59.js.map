{"version":3,"file":"scripts/terminal.5ba9fb59.js","mappings":"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","sources":["webpack:///./node_modules/@xterm/addon-fit/lib/addon-fit.js","webpack:///./node_modules/typescript-event-target/dist/index.mjs","webpack:///./src/latest/scripts/interpreter/runner.ts","webpack:///./src/latest/scripts/ui/VyTerminal.tsx"],"sourcesContent":["!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.FitAddon=t():e.FitAddon=t()}(self,(()=>(()=>{\"use strict\";var e={};return(()=>{var t=e;Object.defineProperty(t,\"__esModule\",{value:!0}),t.FitAddon=void 0,t.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const r=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue(\"height\")),s=Math.max(0,parseInt(i.getPropertyValue(\"width\"))),n=window.getComputedStyle(this._terminal.element),l=o-(parseInt(n.getPropertyValue(\"padding-top\"))+parseInt(n.getPropertyValue(\"padding-bottom\"))),a=s-(parseInt(n.getPropertyValue(\"padding-right\"))+parseInt(n.getPropertyValue(\"padding-left\")))-r;return{cols:Math.max(2,Math.floor(a/t.css.cell.width)),rows:Math.max(1,Math.floor(l/t.css.cell.height))}}}})(),e})()));\n//# sourceMappingURL=addon-fit.js.map","var e=class extends EventTarget{dispatchTypedEvent(s,t){return super.dispatchEvent(t)}};export{e as TypedEventTarget};\n","import { Terminal } from \"@xterm/xterm\";\nimport { FitAddon } from \"@xterm/addon-fit\";\nimport { TypedEventTarget } from \"typescript-event-target\";\nconst MAX_BUFFER_SIZE = 20000;\nexport var TerminateReason;\n(function (TerminateReason) {\n    TerminateReason[TerminateReason[\"Terminated\"] = 0] = \"Terminated\";\n    TerminateReason[TerminateReason[\"TimedOut\"] = 1] = \"TimedOut\";\n})(TerminateReason || (TerminateReason = {}));\nexport class VyRunner extends TypedEventTarget {\n    constructor(splashes, version) {\n        super();\n        this.workerCounter = 0;\n        this.outputBuffer = [];\n        this._state = \"booting\";\n        this.currentGroup = 0;\n        this.runAllGroups = true;\n        this.splashes = splashes;\n        this.version = version;\n        this.worker = this.spawnWorker();\n    }\n    attach(element) {\n        if (this.terminal != null) {\n            throw new Error(\"Already attached\");\n        }\n        this.terminal = new Terminal({\n            scrollback: 1000,\n            convertEol: true,\n        });\n        this.fit = new FitAddon();\n        this.terminal.loadAddon(this.fit);\n        this.terminal.open(element);\n        this.fit.fit();\n        new ResizeObserver(() => requestAnimationFrame(() => this.onResize())).observe(element);\n        this.terminal.writeln(`\\x1b[?25lWelcome to \\x1b[1;95mVyxal\\x1b[0m ${this.version}`);\n        this.terminal.writeln(`\\x1b[2;3m${this.splashes[Math.floor(Math.random() * this.splashes.length)]}\\x1b[0m`);\n        console.log(\"Terminal attached\");\n    }\n    onResize() {\n        this.fit?.fit();\n    }\n    detach() {\n        if (this.terminal == null) {\n            throw new Error(\"Not attached\");\n        }\n        this.terminal.dispose();\n        this.terminal = null;\n        this.fit = null;\n        console.log(\"Terminal detached\");\n    }\n    get state() {\n        return this._state;\n    }\n    spawnWorker() {\n        console.log(\"Spawning new worker\");\n        this.workerCounter += 1;\n        return new Promise((resolve) => {\n            const worker = new Worker(\n            /* webpackChunkName: \"worker\" */\n            new URL(\"../workers/runner.ts\", import.meta.url));\n            const listener = (event) => {\n                if (event.data.type == \"ready\") {\n                    resolve(worker);\n                    worker.addEventListener(\"message\", this.onWorkerMessage.bind(this));\n                    worker.removeEventListener(\"message\", listener);\n                    console.log(\"Worker is ready\");\n                    this._state = \"idle\";\n                    this.dispatchTypedEvent(\"ready\", new Event(\"ready\"));\n                }\n            };\n            // possible race condition? won't appear in practice\n            // but if they ever develop internet that's faster than the speed of light it could be an issue\n            worker.addEventListener(\"message\", listener);\n        });\n    }\n    runningGroupChanged(group) {\n        this.dispatchTypedEvent(\"runningGroupChanged\", new CustomEvent(\"runningGroupChanged\", { detail: { group } }));\n    }\n    onWorkerMessage(message) {\n        const data = message.data;\n        if (data.workerNumber != this.workerCounter) {\n            console.warn(\"Discarding old worker message\");\n            return;\n        }\n        if (this.terminal != null) {\n            switch (data.type) {\n                case \"started\": {\n                    this._state = \"running\";\n                    this.runningGroupChanged(this.currentGroup);\n                    break;\n                }\n                case \"stdout\": {\n                    this.terminal.write(data.text);\n                    const buffer = this.outputBuffer.at(-1);\n                    buffer.push(data.text);\n                    buffer.length = Math.min(buffer.length, MAX_BUFFER_SIZE);\n                    break;\n                }\n                case \"stderr\": {\n                    this.terminal.write(`\\x1b[31m${data.text}\\x1b[0m`);\n                    break;\n                }\n                case \"worker-notice\": {\n                    this.terminal.writeln(`\\x1b[2m${data.text}\\x1b[0m`);\n                    break;\n                }\n                case \"done\": {\n                    if (this.timeoutHandle != null) {\n                        window.clearTimeout(this.timeoutHandle);\n                    }\n                    const now = performance.now();\n                    this.terminal?.writeln(`\\n\\x1b[0G\\x1b[0;2mFinished in ${Math.round((now - this.groupStartedAt)) / 1000} seconds\\x1b[0m`);\n                    if (this.outputBuffer.at(-1).join(\"\").trim() == this.inputs[this.currentGroup].name) {\n                        this.dispatchTypedEvent(\"groupSucceeded\", new CustomEvent(\"groupSucceeded\", { detail: { group: this.currentGroup } }));\n                    }\n                    if (this.runAllGroups && this.inputs.length > 0 && ++this.currentGroup != this.inputs.length && this._state == \"running\") {\n                        this.runNextGroup(this.code, this.flags);\n                    }\n                    else {\n                        this.terminal?.writeln(`\\x1b[1;92mExecution completed\\x1b[0m in ${Math.round((now - this.executionStartedAt)) / 1000} seconds`);\n                        this._state = \"idle\";\n                        this.runningGroupChanged(null);\n                    }\n                    break;\n                }\n            }\n        }\n    }\n    runNextGroup(code, flags) {\n        const group = this.inputs[this.currentGroup];\n        const inputs = group?.inputs ?? [];\n        if (group != undefined) {\n            this.terminal?.writeln(`\\x1b[92mRunning group: ${group.name}\\x1b[0m`);\n        }\n        this.outputBuffer.push([]);\n        return this.worker.then((worker) => {\n            this.groupStartedAt = performance.now();\n            if (this.timeout != null) {\n                this.timeoutHandle = window.setTimeout(() => {\n                    this.terminate(TerminateReason.TimedOut);\n                }, this.timeout * 1000);\n            }\n            worker.postMessage({ code, flags, inputs: inputs.map(({ input }) => input), workerNumber: this.workerCounter });\n        });\n    }\n    async start(code, flags, inputs, group, timeout) {\n        if (code == \"lyxal\") {\n            window.location.assign(\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\");\n            return;\n        }\n        if (this._state == \"running\") {\n            throw new Error(\"Attempted to start while running\");\n        }\n        await this.worker;\n        this.terminal?.clear();\n        this.terminal?.reset();\n        this.outputBuffer.length = 0;\n        this.inputs = [...inputs];\n        this.currentGroup = group != null ? group : 0;\n        this.runAllGroups = group == null;\n        this.code = code;\n        this.flags = flags;\n        this.timeout = timeout;\n        this.runNextGroup(code, flags).then(() => {\n            this.executionStartedAt = this.groupStartedAt;\n        });\n    }\n    async terminate(reason = TerminateReason.Terminated) {\n        if (this._state != \"running\") {\n            throw new Error(\"Attempted to terminate worker while not running\");\n        }\n        console.log(\"Terminating worker\");\n        await this.worker.then((worker) => {\n            this._state = \"booting\";\n            this.worker = this.spawnWorker();\n            worker.terminate();\n            this.terminal?.writeln(\"\\n\\x1b[0G-------\");\n            switch (reason) {\n                case TerminateReason.Terminated:\n                    this.terminal?.writeln(\"\\x1b[1;31mExecution terminated\\x1b[0m\");\n                    break;\n                case TerminateReason.TimedOut:\n                    this.terminal?.writeln(\"\\x1b[1;31mExecution timed out\\x1b[0m\");\n                    break;\n            }\n            this.runningGroupChanged(null);\n            if (this.timeoutHandle != null) {\n                window.clearTimeout(this.timeoutHandle);\n            }\n        });\n    }\n    getOutput() {\n        return this.outputBuffer.join(\"\");\n    }\n    showMessage(message) {\n        if (this._state == \"idle\") {\n            this.terminal?.clear();\n            this.terminal?.reset();\n            this.terminal?.write(message);\n        }\n    }\n}\n","import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { forwardRef, useCallback, useContext, useEffect, useImperativeHandle, useMemo, useRef } from \"react\";\nimport { VyRunner, TerminateReason } from \"../interpreter/runner\";\nimport { ElementDataContext } from \"../interpreter/element-data\";\nimport splashes from \"../../data/splash.txt?raw\";\nimport { serializeFlags } from \"../interpreter/flags\";\nconst VyTerminal = forwardRef(function VyTerminal({ onRunningGroupChanged, onGroupSucceeded, onReady }, ref) {\n    const wrapperRef = useRef(null);\n    const elementData = useContext(ElementDataContext);\n    const runner = useMemo(() => new VyRunner(splashes.trim().split(\"\\n\"), elementData.version), [elementData]);\n    const runningGroupChangedCallback = useCallback((e) => {\n        onRunningGroupChanged(e.detail.group);\n    }, [onRunningGroupChanged]);\n    const groupSucceededCallback = useCallback((e) => {\n        onGroupSucceeded(e.detail.group);\n    }, [onGroupSucceeded]);\n    useImperativeHandle(ref, () => {\n        return {\n            start(code, flags, inputs, group, timeout) {\n                runner.start(code, [...serializeFlags(elementData.flagDefs, flags)], inputs, group, timeout);\n            },\n            stop() {\n                return runner.terminate(TerminateReason.Terminated);\n            },\n            getOutput() {\n                return runner.getOutput();\n            },\n            showMessage(message) {\n                return runner.showMessage(message);\n            },\n        };\n    });\n    useEffect(() => {\n        runner.addEventListener(\"runningGroupChanged\", runningGroupChangedCallback);\n        runner.addEventListener(\"groupSucceeded\", groupSucceededCallback);\n        runner.addEventListener(\"ready\", () => onReady?.(), { once: true });\n        return () => {\n            runner.removeEventListener(\"runningGroupChanged\", runningGroupChangedCallback);\n        };\n    }, [onReady, runner, runningGroupChangedCallback, groupSucceededCallback]);\n    useEffect(() => {\n        runner.attach(wrapperRef.current);\n        return () => {\n            runner.detach();\n        };\n    }, [runner]);\n    return _jsx(\"div\", { ref: wrapperRef, className: \"terminal-wrapper\" });\n});\nexport default VyTerminal;\n"],"names":["t","self","e","Object","defineProperty","value","FitAddon","activate","this","_terminal","dispose","fit","proposeDimensions","isNaN","cols","rows","_core","_renderService","clear","resize","element","parentElement","dimensions","css","cell","width","height","r","options","scrollback","viewport","scrollBarWidth","i","window","getComputedStyle","o","parseInt","getPropertyValue","s","Math","max","n","l","a","floor","module","exports","EventTarget","dispatchTypedEvent","super","dispatchEvent","TerminateReason","VyRunner","constructor","splashes","version","workerCounter","outputBuffer","_state","currentGroup","runAllGroups","worker","spawnWorker","attach","terminal","Error","Terminal","convertEol","loadAddon","open","ResizeObserver","requestAnimationFrame","onResize","observe","writeln","random","length","console","log","detach","state","Promise","resolve","Worker","URL","listener","event","data","type","addEventListener","onWorkerMessage","bind","removeEventListener","Event","runningGroupChanged","group","CustomEvent","detail","message","workerNumber","write","text","buffer","at","push","min","timeoutHandle","clearTimeout","now","performance","round","groupStartedAt","join","trim","inputs","name","runNextGroup","code","flags","executionStartedAt","warn","undefined","then","timeout","setTimeout","terminate","TimedOut","postMessage","map","input","start","reset","location","assign","reason","Terminated","getOutput","showMessage","VyTerminal","forwardRef","onRunningGroupChanged","onGroupSucceeded","onReady","ref","wrapperRef","useRef","elementData","useContext","runner","useMemo","split","runningGroupChangedCallback","useCallback","groupSucceededCallback","useImperativeHandle","flagDefs","stop","useEffect","once","current","className"],"sourceRoot":""}